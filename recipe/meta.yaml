{% set name = "diffoscope" %}
{% set version = "139" %}

package:
  name: {{ name }}
  version: {{ version }}

source:
  url: https://pypi.io/packages/source/{{ name[0] }}/{{ name }}/{{ name }}-{{ version }}.tar.gz
  sha256: 1c69ed2272523c676e719d44596ae52f7725bf2760e36dd2164255e56293eabd

build:
  number: 0
  noarch: python
  script: {{ PYTHON }} -m pip install . --no-deps -vv
  entry_points:
    - diffoscope = diffoscope.main:main

requirements:
  build:
    - python >=3.5
    - pip
  run:
    - python >=3.5
    - python-libarchive-c
    - python-magic
    - python-tlsh

test:
  source_files:
    - tests
  requires:
    - pytest
    - pip
  imports:
    - diffoscope
  commands:
    - pip check
    - diffoscope --help
    - diffoscope --list-tools
    - diffoscope --version
    - |-
      pytest ./tests -k "\
        not assert_non_existing \
        and not berkeley_db \
        and not test_icc \
        and not test_item1_elf \
        and not test_code_is_black_clean \
        and not ocaml \
        and not test_ignore_readelf_errors \
        and not test_libmix_differences \
      "

about:
  home: https://diffoscope.org
  license: GPL-3.0-or-later
  summary: in-depth comparison of files, archives, and directories
  license_family: GPL
  license_file: COPYING
  dev_url: https://anonscm.debian.org/cgit/reproducible/diffoscope.git
  description: >
    diffoscope will try to get to the bottom of what makes files or directories different. It will recursively unpack archives of many kinds and transform various
    binary formats into more human readable form to compare them. It can compare two tarballs, ISO images, or PDF just as easily.

extra:
  recipe-maintainers:
    - bollwyvl
